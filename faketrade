print("üöÄ Script start")

local Players = game:GetService("Players")
local player = Players.LocalPlayer

if not player then
	warn("‚ùå Kh√¥ng t√¨m th·∫•y LocalPlayer")
	return
end

task.wait()

local NEW_FOLDER_NAME = "Trade_Copy"

print("üîé ƒêang l·∫•y GUI...")

local playerGui = player:WaitForChild("PlayerGui")
print("‚úÖ PlayerGui OK")

local main = playerGui:WaitForChild("Main")
print("‚úÖ Main OK")

local trade = main:WaitForChild("Trade")
print("‚úÖ Trade OK")

local container = trade:WaitForChild("Container")
local two = container:WaitForChild("2")
local frame = two:WaitForChild("Frame")

local lock2 = trade:WaitForChild("Lock2")
local countdown = trade:WaitForChild("Countdown")

local info = trade:WaitForChild("Info")
local ready1 = info:WaitForChild("Ready1")
local ready2 = info:WaitForChild("Ready2")

print("‚úÖ T·∫•t c·∫£ GUI refs OK")

-- ===== READY CHECK =====
local function isReadyText(text)
	if not text then return false end
	text = string.gsub(text, "^%s+", "")
	text = string.gsub(text, "%s+$", "")
	return text == "Ready!"
end

-- ===== SAVE POSITION =====
local function saveUI(ui)
	print("üìç Save UI:", ui.Name)
	return {
		pos = ui.AbsolutePosition,
		size = ui.AbsoluteSize
	}
end

local lock2Info = saveUI(lock2)
local countdownOffset = countdown.AbsolutePosition - two.AbsolutePosition

-- ===== CREATE FOLDER =====
print("üìÅ T·∫°o folder clone")

local folder = Instance.new("Folder")
folder.Name = NEW_FOLDER_NAME
folder.Parent = main

local destroyed = false

-- ===== COPY ICON =====
print("üß¨ Clone icon...")

for _, icon in ipairs(frame:GetChildren()) do
	if icon:IsA("ImageLabel") or icon:IsA("ImageButton") then
		if not string.find(icon.Name, "Template") then
			print("‚û°Ô∏è Clone:", icon.Name)

			local clone = icon:Clone()
			clone.Parent = folder

			clone.AnchorPoint = Vector2.new(0, 0)
			clone.Position = UDim2.fromOffset(
				icon.AbsolutePosition.X,
				icon.AbsolutePosition.Y
			)
			clone.Size = UDim2.fromOffset(
				icon.AbsoluteSize.X,
				icon.AbsoluteSize.Y
			)

			clone.ZIndex = icon.ZIndex
			clone.Visible = true
		end
	end
end

-- ===== CLONE LOCK2 & COUNTDOWN =====
print("üîê Clone Lock2 & Countdown")

local lock2Clone = lock2:Clone()
local countdownClone = countdown:Clone()

lock2Clone.Parent = folder
countdownClone.Parent = folder

lock2Clone.AnchorPoint = Vector2.new(0, 0)
lock2Clone.Position = UDim2.fromOffset(lock2Info.pos.X, lock2Info.pos.Y)
lock2Clone.Size = UDim2.fromOffset(lock2Info.size.X, lock2Info.size.Y)
lock2Clone.ZIndex = 50
lock2Clone.Visible = false

countdownClone.AnchorPoint = Vector2.new(0, 0)
countdownClone.Position = UDim2.fromOffset(
	two.AbsolutePosition.X + countdownOffset.X,
	two.AbsolutePosition.Y + countdownOffset.Y
)
countdownClone.Size = UDim2.fromOffset(
	countdown.AbsoluteSize.X,
	countdown.AbsoluteSize.Y
)
countdownClone.ZIndex = 50
countdownClone.Visible = false

-- ===== COUNTDOWN LOGIC =====
local counting = false
local countdownDone = false

local function startCountdown()
	if counting or countdownDone then return end

	print("‚è≥ B·∫Øt ƒë·∫ßu countdown")

	counting = true

	for i = 10, 1, -1 do
		print("‚è±Ô∏è Countdown:", i)

		if countdownClone:IsA("TextLabel") or countdownClone:IsA("TextButton") then
			countdownClone.Text = tostring(i)
		else
			warn("‚ùå Countdown kh√¥ng ph·∫£i TextLabel")
		end

		task.wait(1)
	end

	print("‚úÖ Countdown xong")

	countdownDone = true
	counting = false
end

-- ===== TRADE VISIBLE =====
trade:GetPropertyChangedSignal("Visible"):Connect(function()
	print("üëÅÔ∏è Trade Visible changed:", trade.Visible)

	if trade.Visible == false and not destroyed then
		print("üßπ Xo√° folder clone")

		destroyed = true

		if folder and folder.Parent then
			folder:Destroy()
		end
	end
end)

-- ===== LOOP READY =====
task.spawn(function()
	print("üîÅ Ready loop start")

	while not destroyed do
		local r1 = isReadyText(ready1.Text)
		local r2 = isReadyText(ready2.Text)

		if r1 or r2 then
			print("üìä Ready status:", r1, r2)
		end

		lock2Clone.Visible = r2

		if r1 and r2 then
			print("üî• C·∫£ 2 ready")

			countdownClone.Visible = true
			startCountdown()
		else
			if not countdownDone then
				countdownClone.Visible = false
			end
		end

		task.wait(0.05)
	end

	print("üõë Loop d·ª´ng")
end)

print("‚úÖ Script loaded ho√†n t·∫•t")
